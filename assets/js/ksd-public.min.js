jQuery(document).ready(function(){jQuery("button#ksd-new-ticket-public").length&&jQuery("button#ksd-new-ticket-public").click(function(e){e.preventDefault(),jQuery(".ksd-form-hidden-tab").toggle("slide")}),jQuery("div.ksd-form-short-code").length&&(jQuery("div.ksd-form-short-code").removeClass("hidden"),jQuery("div.ksd-form-short-code div.ksd-close-form-wrapper").remove()),logNewTicket=function(e){return"undefined"==typeof grecaptcha||grecaptcha.getResponse()?(targetFormClass=".ksd-form-hidden-tab-form",jQuery(e).hasClass("ksd-form-short-code-form")&&(targetFormClass=".ksd-form-short-code-form"),jQuery(e).hasClass("ksd-register-public")&&(targetFormClass=".ksd-register-public"),jQuery(targetFormClass+" img.ksd_loading_dialog").show(),jQuery("form"+targetFormClass+" :submit").hide(),void jQuery.post(ksd_public.ajax_url,jQuery(e).serialize(),function(e){jQuery(targetFormClass+" img.ksd_loading_dialog").hide();var r={};try{r=JSON.parse(e)}catch(s){return jQuery("div"+targetFormClass+"-response").show().html(ksd_public.ksd_public_labels.msg_error_refresh),void jQuery("form"+targetFormClass+" :submit").show()}return"undefined"!=typeof r.error?(jQuery("div"+targetFormClass+"-response").show().html(r.error.message),void jQuery("form"+targetFormClass+" :submit").show()):(jQuery("div"+targetFormClass+"-response").show().html(r),".ksd-register-public"===targetFormClass&&window.location.replace(ksd_public.ksd_submit_tickets_url),void jQuery("form"+targetFormClass).remove())})):void jQuery("span.ksd-g-recaptcha-error").html(ksd_public.ksd_public_labels.msg_grecaptcha_error)},_attachValidateEventToSupportForm=function(e){jQuery(e).validate({submitHandler:function(e){logNewTicket(e)}})},jQuery("div.ksd-form-short-code form").length&&_attachValidateEventToSupportForm("div.ksd-form-short-code form"),jQuery("div.ksd-form-hidden-tab").length&&_attachValidateEventToSupportForm("div.ksd-form-hidden-tab form"),_togglePublicFormFieldValues=function(){function e(e){jQuery(this).val()===e.data.oldValue&&jQuery(this).val(e.data.newValue)}var r={ksd_cust_fullname:ksd_public.ksd_public_labels.lbl_name,ksd_tkt_subject:ksd_public.ksd_public_labels.lbl_subject,ksd_cust_email:ksd_public.ksd_public_labels.lbl_email,ksd_cust_firstname:ksd_public.ksd_public_labels.lbl_first_name,ksd_cust_lastname:ksd_public.ksd_public_labels.lbl_last_name,ksd_cust_username:ksd_public.ksd_public_labels.lbl_username};jQuery.each(r,function(r,s){jQuery("input[name="+r+"]").on("focus",{oldValue:s,newValue:"",fieldName:r},e),jQuery("input[name="+r+"]").on("blur",{oldValue:"",newValue:s,fieldName:r},e)}),jQuery("textarea[name=ksd_tkt_message]").on("focus",function(){jQuery(this).val("")})},_togglePublicFormFieldValues(),jQuery(".ksd-new-ticket-form-wrap img.ksd_close_button,.ksd-register-form-wrap img.ksd_close_button").click(function(){jQuery(".ksd-form-hidden-tab").toggle("slide")}),jQuery("li.ksd-show-password input[name=ksd_cust_show_password]").click(function(){jQuery(this).is(":checked")?jQuery("input[name=ksd_cust_password]").attr("type","text"):jQuery("input[name=ksd_cust_password]").attr("type","password")}),jQuery("#wp-ksd-public-new-reply-wrap").length&&jQuery("#ksd-public-reply-submit").click(function(){jQuery(".ksd-public-spinner").addClass("is-active").removeClass("hidden"),tinyMCE.triggerSave(),jQuery.post(ksd_public.ajax_url,{action:"ksd_reply_ticket",ksd_new_reply_nonce:jQuery("input[name=ksd_new_reply_nonce]").val(),ksd_ticket_reply:tinyMCE.activeEditor.getContent(),ksd_reply_title:jQuery("h1.entry-title").text(),tkt_id:jQuery("ul#ksd-ticket-replies").attr("class").replace("ticket-","")},function(e){var r={};try{jQuery(".ksd-public-spinner").removeClass("is-active").addClass("hidden"),r=JSON.parse(e)}catch(s){return void jQuery("#ksd-public-reply-error").removeClass("hidden").html(ksd_public.ksd_public_labels.msg_error_refresh)}if("undefined"!=typeof r.error)return void jQuery("#ksd-public-reply-error").removeClass("hidden").html(r.error.message);var t=new Date;replyData="<li class='ticket-reply'>",replyData+="<span class='reply_author'>"+r.post_author+"</span>",replyData+='<span class="reply_date">'+t.toLocaleString()+"</span>",replyData+="<div class='reply_message'>",jQuery("#ksd-public-reply-success").removeClass("hidden").html(ksd_public.ksd_public_labels.msg_reply_sent).delay(3e3).fadeOut(),replyData+=tinyMCE.activeEditor.getContent(),tinyMCE.activeEditor.setContent(""),replyData+="</div>",replyData+="</li>",jQuery("ul#ksd-ticket-replies").append(replyData)})})});
