"undefined"!=typeof google&&google.load("visualization","1",{packages:["corechart"]}),jQuery(document).ready(function(){jQuery("#admin-kanzu-support-desk").css({visibility:"visible"}),jQuery("#tabs").tabs().addClass("ui-tabs-vertical ui-helper-clearfix"),jQuery("#tabs > ul > li").removeClass("ui-corner-top").addClass("ui-corner-left"),jQuery.urlParam=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.href);return null===e?null:e[1]||0},jQuery.validator.addMethod("ccRule",function(t,e){if(jQuery(e).val()==ksd_admin.ksd_labels.lbl_CC)return!0;for(emails=jQuery(e).val().split(","),cnt=emails.length,i=0;i<cnt;i++)if(_status=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@(?:\S{1,63})$/.test(emails[i]),_status===!1)return!1;return!0},ksd_admin.ksd_labels.validator_cc),jQuery.validator.messages.required=ksd_admin.ksd_labels.validator_required,jQuery.validator.messages.email=ksd_admin.ksd_labels.validator_email,jQuery.validator.messages.minlength=jQuery.validator.format(ksd_admin.ksd_labels.validator_minlength),jQuery.validator.setDefaults({errorPlacement:function(t,e){jQuery(e).css("border-color","red"),jQuery(e).attr("title",jQuery(t).html());var s=jQuery(e).tooltip({position:{my:"top bottom-10",at:"left+120 top"}});s.tooltip("open")},success:function(t,e){jQuery(e).css("border-color",""),jQuery(e).tooltip("destroy")},onfocusout:!0,ignoreTitle:!0}),KSDUtils=function(){_this=this},KSDUtils.showDialog=function(t,e){e=e||ksd_admin.ksd_labels.msg_loading,jQuery(".ksd-dialog").hide(),jQuery("."+t).html(e),jQuery("."+t).fadeIn(400).delay(3e3).fadeOut(400)},KSDUtils.ajaxResponseErrorCheck=function(t){try{respObj=JSON.parse(t)}catch(e){return this.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh),!0}return"undefined"!=typeof respObj.error?(this.showDialog("error",respObj.error.message),!0):!1},KSDUtils.isNumber=function(){return"number"==typeof n&&isFinite(n)&&n%1===0},KSDUtils.capitalizeFirstLetter=function(t){return t.toLowerCase().replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},KSDAnalytics=function(){_this=this},KSDAnalytics.init=function(){"not_a_ksd_screen"!==ksd_admin.ksd_current_screen&&(!function(t,e,s,i,a,n,r){t.GoogleAnalyticsObject=a,t[a]=t[a]||function(){(t[a].q=t[a].q||[]).push(arguments)},t[a].l=1*new Date,n=e.createElement(s),r=e.getElementsByTagName(s)[0],n.async=1,n.src=i,r.parentNode.insertBefore(n,r)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-48956820-3","auto"),ga("require","linkid","linkid.js"),"yes"!==ksd_admin.enable_anonymous_tracking&&(window["ga-disable-UA-48956820-3"]=!0),this.sendPageView(ksd_admin.ksd_current_screen))},KSDAnalytics.sendPageView=function(t){pageName=KSDUtils.capitalizeFirstLetter(t.replace("ksd-","").replace(/\-/g," ")),"Kanzu Support Desk"===pageName&&(pageName="Dashboard",t="ksd-dashboard"),thePage="/"+t,pageTitle=pageName+" - Kanzu Support Desk",ga("send","pageview",{page:thePage,title:pageTitle})},KSDSettings=function(){_this=this,this.init=function(){this.submitSettingsForm(),this.toggleViewsToHide(),this.enableAccordion(),this.changeSubmitBtnVal(),this.modifyLicense(),this.handleAddons(),this.enableUsageStats(),this.doMigrationV2()},this.changeSubmitBtnVal=function(){jQuery(".ksd-send-email :checkbox").click(function(){var t=jQuery(this),e=jQuery("[name=ksd-submit-admin-new-ticket]");e.val(t.is(":checked")?"Send":"Save")})},this.enableUsageStats=function(){jQuery("button.ksd_enable_usage_stats").click(function(){jQuery.post(ksd_admin.ajax_url,{action:"ksd_enable_usage_stats"},function(t){var e={};try{e=JSON.parse(t)}catch(s){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}KSDUtils.showDialog("success",e)})})},this.handleAddons=function(){jQuery("span.ksd-dummy-addons li").appendTo("ul.add-ons"),jQuery("li.ksd-dummy a").click(function(t){t.preventDefault();var e=jQuery(this).parents("li.ksd-dummy").find("h3").text();jQuery("#ksd-dummy-plugin-dialog span.ksd-addon-name").text(e),jQuery("#ksd-dummy-plugin-dialog").dialog({modal:!0,buttons:{"Yes, add me to the waiting list":function(){jQuery(this).dialog("close"),jQuery.post(ksd_admin.ajax_url,{action:"ksd_send_feedback",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,feedback_type:"waiting_list",ksd_user_feedback:e},function(t){var e={};try{e=JSON.parse(t)}catch(s){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}KSDUtils.showDialog("success",e)})},"It's interesting":function(){jQuery(this).dialog("close"),window["ga-disable-UA-48956820-3"]=!1,ga("send","event","button","click",e.toLowerCase())}}})})},this.submitSettingsForm=function(){jQuery("form#update-settings").submit(function(t){t.preventDefault();var e;if(jQuery(this).find("input[type=submit]:focus").hasClass("ksd-reset"))e={action:"ksd_reset_settings",ksd_admin_nonce:ksd_admin.ksd_admin_nonce};else{if(!jQuery(this).find("input[type=submit]:focus").hasClass("ksd-submit"))return!1;e=jQuery(this).serialize()}KSDUtils.showDialog("loading"),jQuery.post(ksd_admin.ajax_url,e,function(t){KSDUtils.ajaxResponseErrorCheck(t)||KSDUtils.showDialog("success",JSON.parse(t))})}),jQuery(".help_tip").tooltip(),jQuery("span.ksd-tkt-status a").tooltip()},this.toggleViewsToHide=function(){var t=["show_support_tab","enable_new_tkt_notifxns","enable_recaptcha","enable_customer_signup"];jQuery.each(t,function(t,e){jQuery("input[name="+e+"]").click(function(){jQuery("."+e).toggle("slide")}),jQuery("input[name="+e+"]").is(":checked")||jQuery("."+e).hide()})},this.enableAccordion=function(){jQuery("div.ksd-settings-accordion h3").length>1?jQuery("div.ksd-settings-accordion").accordion({collapsible:!0,heightStyle:"content"}):jQuery("div.ksd-settings-accordion h3").remove()},this.modifyLicense=function(){jQuery("form.ksd-settings input[name$='_license_status']").click(function(){var t=jQuery(this).parents("div.setting"),e=t.find("span.license_status");e.html(""),e.addClass("loading");var s;s=jQuery(this).hasClass("ksd-activate_license")?"activate_license":"deactivate_license";var i=t.find("span.plugin_name").text(),a=t.find("span.plugin_author_uri").text(),n=t.find("span.plugin_options_key").text(),r=t.find("input[type=text]").attr("name"),d=t.find("input[type=submit]").attr("name"),o=t.find("input[name$='_license_key']").val();jQuery.post(ksd_admin.ajax_url,{action:"ksd_modify_license",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,license_action:s,plugin_name:i,plugin_author_uri:a,plugin_options_key:n,license_key:r,license_status_key:d,license:o},function(t){e.removeClass("loading");try{var s=JSON.parse(t)}catch(i){return void e.html(ksd_admin.ksd_labels.msg_error_refresh)}e.html(s)})})},this.doMigrationV2=function(){if(null!==jQuery(location).attr("href").match(/active_tab=migration/)){var t=jQuery("#ksd-migration-status").parent().parent().index(),e=(t+1)/2-1;jQuery("div.ksd-settings-accordion").accordion("option","active",e)}jQuery("#ksd-migration-tickets").click(function(){jQuery(".ksd-migration-spinner").addClass("is-active"),jQuery("#ksd-migration-tickets").remove(),jQuery("#ksd-migration-status").html(ksd_admin.ksd_labels.msg_migrationv2_started);var t={action:"ksd_migrate_to_v2",ksd_admin_nonce:ksd_admin.ksd_admin_nonce};jQuery.post(ksd_admin.ajax_url,t,function(t){jQuery(".ksd-migration-spinner").removeClass("is-active"),jQuery("#ksd-migration-status").html(t)})}),jQuery("#ksd-migration-deletetickets").click(function(){jQuery(".ksd-migration-spinner").addClass("is-active"),jQuery("#ksd-migration-deletetickets").remove(),jQuery("#ksd-migration-status").html(ksd_admin.ksd_labels.msg_migrationv2_deleting);var t={action:"ksd_deletetables_v2",ksd_admin_nonce:ksd_admin.ksd_admin_nonce};jQuery.post(ksd_admin.ajax_url,t,function(t){jQuery(".ksd-migration-spinner").removeClass("is-active"),jQuery("#ksd-migration-status").html(t)})})}},KSDDashboard=function(){_this=this,this.init=function(){this.statistics(),this.charts(),this.notifications()},_addClickEventToSummaries=function(){jQuery("#admin-kanzu-support-desk ul.dashboard-statistics-summary li.open").click(function(){window.location.href="?post_status=all&post_type=ksd_ticket&ksd_statuses_filter=open"}),jQuery("#admin-kanzu-support-desk ul.dashboard-statistics-summary li.unassigned").click(function(){window.location.href="?post_type=ksd_ticket&ksd_view=unassigned"})},this.statistics=function(){jQuery("ul.dashboard-statistics-summary").hasClass("pending")&&jQuery.post(ksd_admin.ajax_url,{action:"ksd_get_dashboard_summary_stats",ksd_admin_nonce:ksd_admin.ksd_admin_nonce},function(t){jQuery("ul.dashboard-statistics-summary").removeClass("pending");try{var e=JSON.parse(t)}catch(s){return void jQuery("ul.dashboard-statistics-summary").html(ksd_admin.ksd_labels.msg_error)}if("undefined"!=typeof e.error)return void jQuery("ul.dashboard-statistics-summary").html(e.error.message);var i="undefined"!=typeof e.unassigned_tickets?e.unassigned_tickets:0,a="undefined"!=typeof e.open_tickets?e.open_tickets:0,n="undefined"!=typeof e.average_response_time?e.average_response_time:"00:00:00",r="";r+="<li class='open ksd-dash-click'><span>"+ksd_admin.ksd_labels.dashboard_open_tickets+"</span>"+a+"</li>",r+="<li class='unassigned ksd-dash-click'><span>"+ksd_admin.ksd_labels.dashboard_unassigned_tickets+"</span>"+i+"</li>",r+="<li><span>"+ksd_admin.ksd_labels.dashboard_avg_response_time+"</span>"+n+"</li>",jQuery("ul.dashboard-statistics-summary").html(r),_addClickEventToSummaries()})},this.charts=function(){function t(){"ksd-dashboard"===ksd_admin.ksd_current_screen&&jQuery.post(ksd_admin.ajax_url,{action:"ksd_dashboard_ticket_volume",ksd_admin_nonce:ksd_admin.ksd_admin_nonce},function(t){var e=JSON.parse(t);if("undefined"!=typeof e.error)return void jQuery("#ksd_dashboard_chart").html(e.error.message);var s=google.visualization.arrayToDataTable(e),i={title:ksd_admin.ksd_labels.dashboard_chart_title},a=new google.visualization.LineChart(document.getElementById("ksd_dashboard_chart"));google.visualization.events.addListener(a,"ready",function(){!jQuery("ul.ksd-main-nav li:first").hasClass("ui-tabs-active")}),a.draw(s,i)})}try{google.setOnLoadCallback(t)}catch(e){jQuery("#ksd_dashboard_chart").html(e)}},this.notifications=function(){jQuery(".admin-ksd-title span.more_nav img").click(function(t){t.preventDefault(),jQuery(this).toggleClass("active"),jQuery("#ksd-notifications").toggle("slide")});try{if("ksd-dashboard"!==ksd_admin.ksd_current_screen&&"ksd-addons"!==ksd_admin.ksd_current_screen&&"ksd-settings"!==ksd_admin.ksd_current_screen)return;jQuery.post(ksd_admin.ajax_url,{action:"ksd_get_notifications",ksd_admin_nonce:ksd_admin.ksd_admin_nonce},function(t){var e=JSON.parse(t);return"undefined"!=typeof e.error?void jQuery("#ksd-notifications").html(e.error):(notificationsXML=jQuery.parseXML(e),notificationData="<ul>",jQuery(notificationsXML).find("item").each(function(t){return blogPost=jQuery(this),notificationData+="<li>",notificationData+='<a href="'+blogPost.find("link").text()+'" target="_blank" class="post-title">'+blogPost.find("title").text()+"</a>",notificationData+='<span class="date-published">'+blogPost.find("pubDate").text()+"</span>",notificationData+='<a href="'+blogPost.find("link").text()+'" target="_blank" class="excerpt"><p>'+blogPost.find("description").text().substr(0,100)+"...</p></a>",notificationData+="</li>",2>t}),notificationData+="</ul>",void jQuery("#ksd-notifications").html(notificationData))})}catch(t){jQuery("#ksd-notifications").html(t)}}},KSDHelp=function(){_this=this,this.init=function(){this.submitFeedbackForm(),this.generateTourContent()},this.submitFeedbackForm=function(){jQuery("form#ksd-feedback").submit(function(t){t.preventDefault(),KSDUtils.showDialog("loading",ksd_admin.ksd_labels.msg_sending),jQuery.post(ksd_admin.ajax_url,jQuery(this).serialize(),function(t){KSDUtils.ajaxResponseErrorCheck(t)||KSDUtils.showDialog("success",JSON.parse(t))})}),jQuery("form[class^='ksd-feedback-']").submit(function(t){t.preventDefault(),KSDUtils.showDialog("loading",ksd_admin.ksd_labels.msg_sending),jQuery.post(ksd_admin.ajax_url,jQuery(this).serialize(),function(t){KSDUtils.ajaxResponseErrorCheck(t)||KSDUtils.showDialog("success",JSON.parse(t))})})},this.generateTourContent=function(){var t=0;if(ksd_admin.ksd_tour_pointers.ksd_intro_tour){var e=ksd_admin.ksd_tour_pointers.ksd_intro_tour;generatePointer=function(t){jQuery("#tabs").tabs("option","active",e[t].tab),options=jQuery.extend(e[t].options,{close:function(){jQuery.post(ksd_admin.ajax_url,{action:"ksd_disable_tour_mode"})}}),jQuery(e[t].target).pointer(options).pointer("open"),jQuery("a.close").after('<a href="#" class="ksd-next button-primary">'+ksd_admin.ksd_labels.pointer_next+"</a>")},generatePointer(t),jQuery("body").on("click","a.ksd-next",function(s){return s.preventDefault(),jQuery(this).parents(".wp-pointer").hide(),t<=e.length-2?(++t,void generatePointer(t)):void jQuery.post(ksd_admin.ajax_url,{action:"ksd_disable_tour_mode"})})}}},KSDTickets=function(){_this=this,this.init=function(){this.uiListTickets(),this.newTicket(),this.replyTicketForm(),this.attachDeleteTicketEvent(),this.attachChangeTicketStatusEvents(),this.attachAssignToEvents(),this.attachChangeSeverityEvents(),this.attachMarkReadUnreadEvents(),this.uiSingleTicketView(),this.attachCCFieldEvents(),this.ticketInfo(),this.TicketSearch(),this.TicketPagination(),this.attachRefreshTicketsPage()},_totalTicketsPerFilter=function(){if("ksd-ticket-list"===ksd_admin.ksd_current_screen){var t={action:"ksd_filter_totals",ksd_admin_nonce:ksd_admin.ksd_admin_nonce};jQuery.post(ksd_admin.ajax_url,t,function(t){var e={};try{e=JSON.parse(t)}catch(s){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}jQuery.isArray(e)&&jQuery.each(e[0],function(t,e){jQuery("ul.subsubsub li."+t+" a").append('<span class="count"> ('+e+") </span>")})})}},_addSeverityClassToTicketGrid=function(){jQuery("tbody#the-list tr").each(function(){$this=jQuery(this);var t=$this.find("td.column-severity").html();$this.addClass(t)})},this.getTickets=function(t,e,s,i,a){if("undefined"==typeof e&&(e=""),"undefined"==typeof s&&(s=20),("undefined"==typeof i||jQuery.isNumeric(i)===!1)&&(i=0),"undefined"==typeof a&&(a=!1),a?jQuery(".ksd-loading-tickets-overlay").removeClass("hidden"):jQuery(t).addClass("ksd-loading-tickets"),jQuery(t).hasClass("pending")){var n={action:"ksd_filter_tickets",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,view:t,search:e,limit:s,offset:i};jQuery.post(ksd_admin.ajax_url,n,function(e){var n={};try{n=JSON.parse(e)}catch(r){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}if("undefined"!=typeof n.error)return void KSDUtils.showDialog("error",n.error.message);jQuery.isArray(n)?(d=t.replace("#tickets-tab-",""),ticketListData="",ticketListData+='<div class="ksd-row-all-hide" id="ksd_row_all_'+d+'">',ticketListData+='<div  id="tkt_all_options">                                                     <a href="#" class="trash" id="#">Trash All</a> |                                                     <a href="#" id="#" class="change_status">Change All Statuses</a> |                                                     <a href="#" id="#" class="assign_to">Assign All To</a>                                                 </div>',ticketListData+="</div>",jQuery(t+" .ticket-list").html(ticketListData),jQuery.each(n[0],function(e,s){var i="",a='<a href="#" id="tkt_'+s.tkt_id+'" class="mark_unread">'+ksd_admin.ksd_labels.tkt_mark_unread+"</a>";kst_tkt_replies="",s.rep_count>0&&(kst_tkt_replies=" ("+s.rep_count+") "),s.tkt_is_read<1&&(i=" ksd-unread",a='<a href="#" id="tkt_'+s.tkt_id+'" class="mark_read">'+ksd_admin.ksd_labels.tkt_mark_read+"</a>"),ticketListData='<div class="ksd-row-data ticket-list-item ksd-'+s.tkt_status.toLowerCase()+"-ticket "+s.tkt_severity.toLowerCase()+i+'" id="ksd_tkt_id_'+s.tkt_id+'">',ticketListData+='<div class="ticket-info">',ticketListData+='<input type="checkbox" value="'+s.tkt_id+'" name="ticket_ids[]" id="ticket_checkbox_'+s.tkt_id+'">',ticketListData+='<span class="ksd-tkt-status '+s.tkt_status.toLowerCase()+'"><a href="'+ksd_admin.ksd_tickets_url+"&ticket="+s.tkt_id+'&action=edit" title="'+s.tkt_status.toLowerCase()+'">'+s.tkt_status.charAt(0)+"</a></span>",ticketListData+='<span class="ksd-tkt-customer-name"><a href="'+ksd_admin.ksd_tickets_url+"&ticket="+s.tkt_id+'&action=edit">'+s.tkt_cust_id+kst_tkt_replies+"</a></span>",ticketListData+='<span class="subject-and-message-excerpt"><a class="ksd-tkt-subject"href="'+ksd_admin.ksd_tickets_url+"&ticket="+s.tkt_id+'&action=edit">'+s.tkt_subject+"</a>",ticketListData+='<a class="ksd-message-excerpt" href="'+ksd_admin.ksd_tickets_url+"&ticket="+s.tkt_id+'&action=edit"> - '+s.tkt_message_excerpt+"</a></span>",ticketListData+='<span class="ticket-time">'+s.tkt_time_logged+"</span>",ticketListData+="</div>",ticketListData+='<div class="ticket-actions" id="tkt_'+s.tkt_id+'">',ticketListData+='<a href="#" class="trash" id="tkt_'+s.tkt_id+'">'+ksd_admin.ksd_labels.tkt_trash+"</a> | ",ticketListData+='<a href="#" id="tkt_'+s.tkt_id+'" class="change_status">'+ksd_admin.ksd_labels.tkt_change_status+"</a> | ",ticketListData+='<a href="#" id="tkt_'+s.tkt_id+'" class="assign_to">'+ksd_admin.ksd_labels.tkt_assign_to+"</a> | ",ticketListData+='<a href="#" id="tkt_'+s.tkt_id+'" class="change_severity">'+ksd_admin.ksd_labels.tkt_change_severity+"</a> | ",ticketListData+=a,ticketListData+=ksd_admin.ksd_agents_list,ticketListData+='<ul class="status hidden"><li class="OPEN">'+ksd_admin.ksd_labels.tkt_status_open+'</li><li class="PENDING">'+ksd_admin.ksd_labels.tkt_status_pending+'</li><li class="RESOLVED">'+ksd_admin.ksd_labels.tkt_status_resolved+"</li></ul>",ticketListData+='<ul class="severity hidden"><li class="LOW">'+ksd_admin.ksd_labels.tkt_severity_low+'</li><li class="MEDIUM">'+ksd_admin.ksd_labels.tkt_severity_medium+'</li><li class="HIGH">'+ksd_admin.ksd_labels.tkt_severity_high+'</li><li class="URGENT">'+ksd_admin.ksd_labels.tkt_severity_urgent+"</li></ul>",ticketListData+="</div>",ticketListData+="</div>",jQuery(t+" .ticket-list").append(ticketListData)}),jQuery(".ticket-list .ksd-row-data:not(.ksd-open-ticket)").addClass("alternate"),RowCtrlEffects()):(jQuery(t+" #select-all-tickets").remove(),jQuery(t+" .ticket-list").addClass("empty").html(n)),jQuery(t).removeClass("pending"),a?jQuery(".ksd-loading-tickets-overlay").addClass("hidden"):jQuery(t).removeClass("ksd-loading-tickets");var d=t.replace("#tickets-tab-",""),o=n[1],l=i+1;_loadTicketPagination(d,l,o,s),_totalTicketsPerFilter()})}},this.uiListTickets=function(){if(jQuery("ul.subsubsub li.mine")&&(_totalTicketsPerFilter(),_addSeverityClassToTicketGrid()),jQuery.urlParam("ksd_view")){var t=jQuery.urlParam("ksd_view");("mine"===t||"unassigned"===t)&&jQuery("li."+t+" a").addClass("current")}},this.ticketInfo=function(){jQuery("input#ksd-update-ticket-info").click(function(){jQuery("#ksd-ticket-info-action span.spinner").addClass("is-active");var t=jQuery("input[name=post_title]").val();void 0===t&&(t=jQuery("#titlewrap h2.post_title"));var e={action:"ksd_update_ticket_info",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,tkt_id:jQuery.urlParam("post"),ksd_reply_title:t,ksd_tkt_info:jQuery("select[name^='_ksd_tkt_info_']").serialize()};jQuery.post(ksd_admin.ajax_url,e,function(t){var e={};jQuery("#ksd-ticket-info-action span.spinner").removeClass("is-active");try{e=JSON.parse(t)}catch(s){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}_this.getTicketActivity()})})},this.bulkTicketActions=function(){jQuery("#ticket-tabs").on("change",'input[name="ticket_ids[]"]',function(){jQuery('input[name="ticket_ids[]"]:checkbox:checked').length>0?jQuery(".ticket-actions-top-menu").hasClass("hidden")&&jQuery(".ticket-actions-top-menu").removeClass("hidden"):jQuery(".ticket-actions-top-menu").hasClass("hidden")||jQuery(".ticket-actions-top-menu").addClass("hidden")}),jQuery("div.ticket-actions-top-menu a.change_status").click(function(t){t.preventDefault(),jQuery("div.ticket-actions-top-menu ul.status").toggleClass("hidden"),jQuery("div.ticket-actions-top-menu ul.ksd_agent_list").addClass("hidden")}),jQuery("div.ticket-actions-top-menu a.assign_to").click(function(t){t.preventDefault(),jQuery("div.ticket-actions-top-menu ul.ksd_agent_list").toggleClass("hidden"),jQuery("div.ticket-actions-top-menu ul.status").addClass("hidden")}),jQuery("div.ticket-actions-top-menu ul.status").bind("mouseleave",function(){jQuery(this).addClass("hidden")}),jQuery("div.ticket-actions-top-menu ul.ksd_agent_list").bind("mouseleave",function(){jQuery(this).addClass("hidden")}),_getCheckedTicketIDs=function(){var t=[];return jQuery('#ticket-tabs    input[name="ticket_ids[]"]:checkbox:checked').each(function(){tkt_ID=jQuery(this).parent().parent().attr("id").replace("ksd_tkt_id_",""),"undefined"!=typeof tkt_ID&&t.push(tkt_ID)}),t},jQuery("div.ticket-actions-top-menu ul.status li").click(function(){var t=_getCheckedTicketIDs();tktStatus=jQuery(this).attr("class"),_this.changeTicketStatus(t,tktStatus),jQuery("div.ticket-actions-top-menu").addClass("hidden")}),jQuery("div.ticket-actions-top-menu ul.ksd_agent_list li").click(function(){var t=_getCheckedTicketIDs();assignTo=jQuery(this).attr("id"),_this.reassignTicket(t,assignTo),jQuery("div.ticket-actions-top-menu").addClass("hidden")}),jQuery("div.ticket-actions-top-menu a.trash").click(function(t){t.preventDefault();var e=_getCheckedTicketIDs();_this.deleteTicket(e),jQuery("div.ticket-actions-top-menu").addClass("hidden")}),jQuery("#ticket-tabs .tkt_chkbx_all").on("click",function(){jQuery(this).prop("checked")===!0?(jQuery("#tkt_all_options").removeClass("ticket-actions"),jQuery("input:checkbox").not(this).prop("checked",this.checked),tab_id=jQuery(this).attr("id").replace("tkt_chkbx_all_",""),jQuery("#ksd_row_all_"+tab_id).removeClass("ksd-row-all-hide").addClass("ksd-row-all-show")):(jQuery("#tkt_all_options").addClass("ticket-actions"),jQuery("input:checkbox").not(this).prop("checked",this.checked),tab_id=jQuery(this).attr("id").replace("tkt_chkbx_all_",""),jQuery("#ksd_row_all_"+tab_id).removeClass("ksd-row-all-show").addClass("ksd-row-all-hide"))})},this.reassignTicket=function(t,e,s){s="undefined"==typeof s?!1:!0,KSDUtils.showDialog("loading"),jQuery.post(ksd_admin.ajax_url,{action:"ksd_assign_to",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,tkt_id:t,ksd_current_user_id:ksd_admin.ksd_current_user_id,tkt_assign_assigned_to:e},function(t){var e={};try{e=JSON.parse(t)}catch(i){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}return"undefined"!=typeof e.error?void KSDUtils.showDialog("error",e.error.message):(KSDUtils.showDialog("success",e),void(s||_this.ksdRefreshTicketsPage()))})},this.markTicketReadUnread=function(t,e,s){s="undefined"==typeof s?!1:!0,KSDUtils.showDialog("loading"),jQuery.post(ksd_admin.ajax_url,{action:"ksd_change_read_status",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,tkt_id:t,tkt_is_read:e},function(t){var e={};try{e=JSON.parse(t)}catch(i){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}return"undefined"!=typeof e.error?void KSDUtils.showDialog("error",e.error.message):(KSDUtils.showDialog("success",e),void(s||_this.ksdRefreshTicketsPage()))})},this.changeTicketSeverity=function(t,e,s){s="undefined"==typeof s?!1:!0,KSDUtils.showDialog("loading"),jQuery.post(ksd_admin.ajax_url,{action:"ksd_change_severity",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,tkt_id:t,tkt_severity:e},function(t){var e={};try{e=JSON.parse(t)}catch(i){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}return"undefined"!=typeof e.error?void KSDUtils.showDialog("error",e.error.message):(KSDUtils.showDialog("success",e),void(s||_this.ksdRefreshTicketsPage()))})},this.attachDeleteTicketEvent=function(){jQuery("#ticket-tabs").on("click",".ticket-actions a.trash",function(t){t.preventDefault();var e=jQuery(this).attr("id").replace("tkt_","");_this.deleteTicket(e)})},this.deleteTicket=function(t){displayDialog="#delete-dialog",jQuery.isArray(t)&&(displayDialog+="-bulk"),jQuery(displayDialog).dialog({modal:!0,buttons:{Yes:function(){jQuery(this).dialog("close"),KSDUtils.showDialog("loading"),jQuery.post(ksd_admin.ajax_url,{action:"ksd_delete_ticket",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,tkt_id:t},function(e){var s={};try{s=JSON.parse(e)}catch(i){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}return"undefined"!=typeof s.error?void KSDUtils.showDialog("error",s.error.message):(jQuery.isArray(t)?jQuery.each(t,function(t,e){jQuery(".ticket-list div#ksd_tkt_id_"+e).remove()}):jQuery(".ticket-list div#ksd_tkt_id_"+t).remove(),void KSDUtils.showDialog("success",s))})},No:function(){jQuery(this).dialog("close")}}}),jQuery("div.ui-widget-overlay").remove()},this.replyTicketAndUpdateNote=function(){var t=jQuery("input#ksd-reply-ticket-submit").attr("name");jQuery(".ksd-reply-spinner").removeClass("hidden").addClass("is-active"),tinyMCE.triggerSave();var e=jQuery("input[name=post_title]").val();"undefined"==typeof e&&(e=jQuery("#titlewrap h2.post_title").text()),jQuery.post(ksd_admin.ajax_url,{action:t,ksd_admin_nonce:ksd_admin.ksd_admin_nonce,ksd_ticket_reply:tinyMCE.activeEditor.getContent(),ksd_reply_title:e,tkt_private_note:jQuery("textarea[name=tkt_private_note]").val(),tkt_id:jQuery.urlParam("post")},function(e){var s={};try{jQuery(".ksd-reply-spinner").removeClass("is-active").addClass("hidden"),s=JSON.parse(e)}catch(i){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}if("undefined"!=typeof s.error)return void KSDUtils.showDialog("error",s.error.message);var a=new Date;switch(replyData="<li class='ticket-reply "+s.post_type+"'>",replyData+="<span class='reply_author'>"+s.post_author+"</span>",replyData+='<span class="reply_date">'+a.toLocaleString()+"</span>",replyData+="<div class='reply_message'>",t){case"ksd_update_private_note":KSDUtils.showDialog("success",s),replyData+=jQuery("textarea[name=tkt_private_note]").val(),jQuery("textarea[name=tkt_private_note]").val("");break;default:KSDUtils.showDialog("success",ksd_admin.ksd_labels.msg_reply_sent),replyData+=tinyMCE.activeEditor.getContent(),tinyMCE.activeEditor.setContent("")}replyData+="</div>",replyData+="</li>",jQuery("ul#ksd-ticket-replies").append(replyData)})},this.formatSingleReplyMessage=function(t){return replyTag=/(On.*wrote:|Den.*skrev:)/g,t.replace(replyTag,"<div class='ksd_extra'>$1</div>")},this.formatTicketReplies=function(){jQuery('p:contains("-----Original Message-----")').nextUntil("div").andSelf().wrapAll('<div class="ksd_extra"></div>'),jQuery("div.gmail_quote,blockquote.gmail_quote").addClass("ksd_extra"),jQuery("div.yahoo_quoted").addClass("ksd_extra"),jQuery("#ksd-single-ticket .ksd_extra").before('<div class="replies-more" title="'+ksd_admin.ksd_labels.lbl_toggle_trimmed_content+'"></div>'),jQuery("#ksd-single-ticket").on("click",".replies-more",function(){jQuery(this).parents(".ticket-reply").find(".ksd_extra").toggle("slide")}),jQuery(".ksd_extra").toggle()},this.replyTicketForm=function(){jQuery("form#edit-ticket").validate({submitHandler:function(t){_this.replyTicketAndUpdateNote(t)}}),jQuery("input#ksd-reply-ticket-submit").click(function(t){t.preventDefault(),_this.replyTicketAndUpdateNote()}),ksdLogNewTicketAdmin=function(t){KSDUtils.showDialog("loading"),jQuery.post(ksd_admin.ajax_url,jQuery(t).serialize(),function(t){var e={};try{e=JSON.parse(t)}catch(s){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}return"undefined"!=typeof e.error?void KSDUtils.showDialog("error",e.error.message):(KSDUtils.showDialog("success",e),void jQuery.post(ksd_admin.ajax_url,{action:"ksd_notify_new_ticket",ksd_admin_nonce:ksd_admin.ksd_admin_nonce},function(t){try{e=JSON.parse(t)}catch(s){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}KSDUtils.showDialog("success",e),window.location.replace(ksd_admin.ksd_tickets_url)}))})},jQuery("ul.edit-ticket-options li a").click(function(t){switch(t.preventDefault(),action=jQuery(this).attr("href").replace("#",""),action){case"forward_ticket":submitButtonText=ksd_admin.ksd_labels.tkt_forward;break;case"update_private_note":submitButtonText=ksd_admin.ksd_labels.tkt_update_note;break;default:submitButtonText=ksd_admin.ksd_labels.tkt_reply}jQuery("input#ksd-reply-ticket-submit").attr("value",submitButtonText).attr("name","ksd_"+action)}),jQuery("ul.edit-ticket-options").length&&jQuery("#edit-ticket-tabs").tabs()},this.newTicket=function(){_toggleFieldValues(),jQuery("form.ksd-new-ticket-admin :submit").mousedown(function(){tinyMCE.triggerSave()}),jQuery("form.ksd-new-ticket-admin").validate({submitHandler:function(t){ksdLogNewTicketAdmin(t)}}),jQuery('[id^="ksd-add-attachment-"]').click(function(){var t="ksd_attachments";if(jQuery(this).hasClass("ksd_ticket_reply")&&(t="ksd_attachments-single-ticket"),void 0===this.window){this.window=wp.media({title:ksd_admin.ksd_labels.tkt_attach_file,multiple:!0,button:{text:ksd_admin.ksd_labels.tkt_attach}});var e=this;this.window.on("select",function(){var s=e.window.state().get("selection").toArray();jQuery.each(s,function(e,s){attachment=s.toJSON(),attachmentLink='<a href="'+attachment.url+'">'+attachment.filename+' <span="ksd-attach-filesize"> ( '+attachment.filesizeHumanReadable+" )</span></a>",attachmentFormInputUrl='<input type="hidden" name="ksd_attachments[url][]" value="'+attachment.url+'" />',attachmentFormInputTitle='<input type="hidden" name="ksd_attachments[size][]" value="'+attachment.filesizeHumanReadable+'" />',attachmentFormInputSize='<input type="hidden" name="ksd_attachments[filename][]" value="'+attachment.filename+'" />',attachmentFormInput=attachmentFormInputUrl+attachmentFormInputTitle+attachmentFormInputSize,jQuery("ul#"+t).append("<li>"+attachmentLink+'<span class="ksd-close-dialog"></span>'+attachmentFormInput+"</li>")})})}return this.window.open(),!1}),jQuery("#admin-kanzu-support-desk").on("click",".ksd-close-dialog",function(){jQuery(this).parent().remove()})},this.uiTabs=function(){activeTab=0,ksd_admin.ksd_tour_pointers.ksd_intro_tour&&(activeTab=0),jQuery("#tabs .ksd-main-nav li a").click(function(){jQuery(".admin-ksd-title h2").html(jQuery(this).attr("href").replace("#","").replace("_"," ")),"yes"===ksd_admin.enable_anonymous_tracking&&KSDAnalytics.sendPageView(jQuery(this).attr("href").replace("#","ksd-").replace("_","-"))})},this.changeTicketStatus=function(t,e,s){s="undefined"==typeof s?!1:!0,KSDUtils.showDialog("loading"),jQuery.post(ksd_admin.ajax_url,{action:"ksd_change_status",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,tkt_id:t,tkt_status:e},function(t){var e={};try{e=JSON.parse(t)}catch(i){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}return"undefined"!=typeof e.error?void KSDUtils.showDialog("error",e.error.message):(KSDUtils.showDialog("success",e),void(s||_this.ksdRefreshTicketsPage()))})},this.attachCCFieldEvents=function(){jQuery("form.ksd-new-ticket-admin input[name=ksd_tkt_cc]").css({display:"none"}),jQuery("a.ksd-new-ticket-cc").click(function(){jQuery("form.ksd-new-ticket-admin input[name=ksd_tkt_cc]").css({display:"block"})}),jQuery("a.ksd-new-ticket-cc").css("checked"==jQuery("form.ksd-new-ticket-admin input[name=ksd_send_email]").attr("checked")?{display:"block"}:{display:"none"}),jQuery("form.ksd-new-ticket-admin input[name=ksd_send_email]").change(function(){"checked"==jQuery(this).attr("checked")?jQuery("a.ksd-new-ticket-cc").css({display:"block"}):(jQuery("a.ksd-new-ticket-cc").css({display:"none"}),jQuery("form.ksd-new-ticket-admin input[name=ksd_tkt_cc]").css({display:"none"}))})},this.attachChangeTicketStatusEvents=function(){jQuery("#ticket-tabs").on("click",".ticket-actions ul.status li",function(){var t=jQuery(this).parent().parent().attr("id").replace("tkt_",""),e=jQuery(this).attr("class");_this.changeTicketStatus(t,e)}),jQuery("#ticket-tabs").on("click",".ticket-actions a.change_status",function(t){t.preventDefault();
var e=jQuery(this).attr("id").replace("tkt_","");jQuery("#tkt_"+e+" ul.status").toggleClass("hidden"),jQuery(this).parent().find(".ksd_agent_list").addClass("hidden"),jQuery(this).parent().find("ul.severity").addClass("hidden")}),jQuery("#ksd-single-ticket").length&&(jQuery(".ksd-top-nav").on("click","a.change_status",function(t){t.preventDefault(),jQuery("ul.status").toggleClass("hidden")}),jQuery(".ksd-top-nav ul.status").bind("mouseleave",function(){jQuery(this).addClass("hidden")}),jQuery(".ksd-top-nav").on("click","ul.status li",function(){var t=jQuery.urlParam("ticket"),e=jQuery(this).attr("class");_this.changeTicketStatus(t,e,!0)}))},this.attachAssignToEvents=function(){jQuery("#ticket-tabs").on("click",".ticket-actions a.assign_to",function(t){t.preventDefault();var e=jQuery(this).parent().attr("id").replace("tkt_","");jQuery("#tkt_"+e+" ul.ksd_agent_list").toggleClass("hidden"),jQuery(this).parent().find(".status").addClass("hidden"),jQuery(this).parent().find(".severity").addClass("hidden")}),jQuery("#ticket-tabs").on("click",".ticket-actions ul.ksd_agent_list li",function(){var t=jQuery(this).parent().parent().attr("id").replace("tkt_",""),e=jQuery(this).attr("id");_this.reassignTicket(t,e)}),jQuery("#ksd-single-ticket").length&&(jQuery(".ksd-top-nav").on("click","a.assign_to",function(t){t.preventDefault(),jQuery("ul.ksd_agent_list").toggleClass("hidden")}),jQuery(".ksd-top-nav ul.ksd_agent_list").bind("mouseleave",function(){jQuery(this).addClass("hidden")}),jQuery(".ksd-top-nav").on("click","ul.ksd_agent_list li",function(){var t=jQuery.urlParam("ticket"),e=jQuery(this).attr("id");_this.reassignTicket(t,e,!0)}))},this.attachMarkReadUnreadEvents=function(){jQuery("#ticket-tabs").on("click",".ticket-actions a.mark_read",function(t){t.preventDefault();var e=jQuery(this).attr("id").replace("tkt_","");_this.markTicketReadUnread(e,1)}),jQuery("#ticket-tabs").on("click",".ticket-actions a.mark_unread",function(t){t.preventDefault();var e=jQuery(this).attr("id").replace("tkt_","");_this.markTicketReadUnread(e,0)}),jQuery("#ksd-single-ticket").length&&jQuery(".ksd-top-nav").on("click","a.mark_unread",function(t){t.preventDefault();var e=jQuery.urlParam("ticket");_this.markTicketReadUnread(e,0,!0)})},this.attachChangeSeverityEvents=function(){jQuery("#ticket-tabs").on("click",".ticket-actions a.change_severity",function(t){t.preventDefault();var e=jQuery(this).attr("id").replace("tkt_","");jQuery("#tkt_"+e+" ul.severity").toggleClass("hidden"),jQuery(this).parent().find(".ksd_agent_list").addClass("hidden"),jQuery(this).parent().find("ul.status").addClass("hidden")}),jQuery("#ticket-tabs").on("click",".ticket-actions ul.severity li",function(){var t=jQuery(this).parent().parent().attr("id").replace("tkt_",""),e=jQuery(this).attr("class");_this.changeTicketSeverity(t,e)}),jQuery("#ksd-single-ticket").length&&(jQuery(".ksd-top-nav").on("click","a.change_severity",function(t){t.preventDefault(),jQuery("ul.severity").toggleClass("hidden")}),jQuery(".ksd-top-nav ul.severity").bind("mouseleave",function(){jQuery(this).addClass("hidden")}),jQuery(".ksd-top-nav").on("click","ul.severity li",function(){var t=jQuery.urlParam("ticket"),e=jQuery(this).attr("class");_this.changeTicketSeverity(t,e,!0)}))},this.uiSingleTicketView=function(){jQuery.urlParam("post")>0&&jQuery(".ksd-misc-customer").length&&(jQuery("#post-body").addClass("ksd-ticket-post-body"),jQuery("#titlewrap label#title-prompt-text").remove(),jQuery("#titlewrap").html('<h2 class="post_title">'+jQuery("#titlewrap input#title").val()+"</h2>")),jQuery("#ksd-ticket-replies").hasClass("pending")&&(jQuery.post(ksd_admin.ajax_url,{action:"ksd_get_ticket_replies",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,tkt_id:jQuery.urlParam("post")},function(t){var e={};try{e=JSON.parse(t)}catch(s){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}return t=e,"undefined"!=typeof e.error?void KSDUtils.showDialog("error",e.error.message):(repliesData="",jQuery.each(e,function(t,e){repliesData+="<li class='ticket-reply "+e.post_type+"'>",repliesData+="<span class='reply_author'>"+e.post_author+"</span>",repliesData+="<span class='reply_date'>"+e.post_date+"</span>",null!=e.rep_cc&&e.rep_cc.match(/@/)&&(repliesData+="<div><span class='ksd_cc'>"+ksd_admin.ksd_labels.lbl_CC+": "+e.rep_cc+"</span></div>",jQuery("#edit-ticket #reply_toall_button").attr("data",e.rep_cc),jQuery("#edit-ticket #reply_toall_button").attr("hascc","1"),jQuery("#edit-ticket #reply_toall_button").css({display:"inline-block"})),repliesData+="<div class='reply_message'>"+_this.formatSingleReplyMessage(e.post_content)+"</div>",jQuery.isEmptyObject(e.attachments)||(repliesData+='<ul id="ksd_attachments">',jQuery.each(e.attachments,function(t,e){repliesData+='<li><a href="'+e.attach_url+'">'+e.attach_filename+" ( "+e.attach_size+" )</a></li>"}),repliesData+="</ul>"),repliesData+="</li>"}),jQuery("ul#ksd-ticket-replies").html(repliesData),void _this.formatTicketReplies())}),jQuery("#edit-ticket #reply_toall_button").click(function(){jQuery("form#edit-ticket input[name=ksd_tkt_cc]").css({display:"block"}),jQuery("form#edit-ticket input[name=ksd_tkt_cc]").val(jQuery(this).attr("data"))})),jQuery("#ksd-activity-metabox").hasClass("pending")&&_this.getTicketActivity(),_this.modifySubmitDiv()},this.modifySubmitDiv=function(){if("ksd_ticket"===jQuery.urlParam("post_type")||jQuery("#ksd-messages-metabox").length){jQuery("#submitdiv.postbox").prependTo("#side-sortables.meta-box-sortables"),jQuery("select#post_status").html(ksd_admin.ksd_ticket_info.status_list);var t=jQuery("#hidden_ksd_post_status").val();if("auto-draft"===t&&(t="open"),jQuery("#post-status-display").text(t).addClass("ksd-post-status-display").addClass(t),jQuery("a.save-post-status").click(function(t){t.preventDefault();var e=jQuery("option:selected",jQuery("#post_status")).val();jQuery("#hidden_ksd_post_status").val(e),jQuery("#post-status-display").removeClass().addClass("ksd-post-status-display").addClass(e)}),jQuery("#save-post").val(ksd_admin.ksd_labels.lbl_save),jQuery("a.cancel-severity,a.cancel-assign-to,a.cancel-customer").click(function(t){t.preventDefault(),jQuery(this).parent().addClass("hidden")}),jQuery("a.edit-assign-to,a.edit-severity,a.edit-customer").click(function(t){t.preventDefault(),jQuery(this).parent().find("div.ksd_tkt_info_wrapper").removeClass("hidden")}),jQuery("a.save-severity,a.save-assign-to,a.save-customer").click(function(t){t.preventDefault();var e=jQuery(this).parent(),s=jQuery("option:selected",e.find("select")).text();e.parent().hasClass("ksd-misc-severity")&&e.parent().find(".ksd-misc-value").text(s).removeClass().addClass("ksd-misc-value").addClass(s.toLowerCase()),e.parent().hasClass("ksd-misc-customer")?e.parent().find(".ksd-misc-value").text(s).removeClass().addClass("ksd-misc-value").addClass(s.toLowerCase()):e.parent().find(".ksd-misc-value").text(s),e.addClass("hidden")}),jQuery.urlParam("post")>0&&jQuery(".ksd-misc-customer")&&jQuery("#publish").val(ksd_admin.ksd_labels.lbl_update),jQuery("#submitdiv #visibility").hide(),jQuery("#submitdiv #timestamp").parent().hide(),jQuery.urlParam("post")>0){var e='<div class="misc-pub-section curtime misc-pub-curtime" style="">';e+='<span id="timestamp">',e+=ksd_admin.ksd_labels.lbl_created_on+": <b>"+jQuery("#submitdiv #timestamp b").text()+"</b></span>",e+="</div>",jQuery("#misc-publishing-actions").append(e)}}},this.getTicketActivity=function(){jQuery.post(ksd_admin.ajax_url,{action:"ksd_get_ticket_activity",ksd_admin_nonce:ksd_admin.ksd_admin_nonce,ksd_reply_title:jQuery("input[name=post_title]").val(),tkt_id:jQuery.urlParam("post")},function(t){var e={};try{e=JSON.parse(t)}catch(s){return void KSDUtils.showDialog("error",ksd_admin.ksd_labels.msg_error_refresh)}if("undefined"!=typeof e.error)return void KSDUtils.showDialog("error",e.error.message);if(!jQuery.isArray(e))return void jQuery("#ksd-activity-metabox").html(e);var i="<ul>";jQuery.each(e,function(t,e){i+="<li>"+e.post_date+" "+e.post_author+" "+e.post_content+"</li>"}),i+="</ul>",jQuery("#ksd-activity-metabox").html(i)})},_toggle_form_field_input=function(t){jQuery(this).val()===t.data.old_value&&jQuery(this).val(t.data.new_value)},_toggleFieldValues=function(){var t={ksd_tkt_subject:ksd_admin.ksd_labels.tkt_subject,ksd_cust_fullname:ksd_admin.ksd_labels.tkt_cust_fullname,ksd_cust_email:ksd_admin.ksd_labels.tkt_cust_email,ksd_tkt_cc:ksd_admin.ksd_labels.lbl_CC};jQuery.each(t,function(t,e){jQuery("form.ksd-new-ticket-admin input[name="+t+"]").on("focus",{old_value:e,new_value:""},_toggle_form_field_input),jQuery("form.ksd-new-ticket-admin input[name="+t+"]").on("blur",{old_value:"",new_value:e},_toggle_form_field_input)})},this.TicketPagination=function(){jQuery(".ksd-pagination-limit").bind("mouseleave",function(){var t=jQuery(this).val(),e=jQuery(this).attr("id").replace("ksd_pagination_limit_",""),s=jQuery("input[name=ksd_tkt_search_input_"+e+"]").val(),i="#tickets-tab-"+e;jQuery(i).addClass("pending"),_this.getTickets("#tickets-tab-"+e,s,t,0,!0)}),jQuery(".ksd-pagination-limit").bind("keypress",function(t){if(13===t.keyCode){var e=jQuery(this).val(),s=jQuery(this).attr("id").replace("ksd_pagination_limit_",""),i=jQuery("input[name=ksd_tkt_search_input_"+s+"]").val(),a="#tickets-tab-"+s;jQuery(a).addClass("pending"),_this.getTickets("#tickets-tab-"+s,i,e,0,!0)}})},this.ksdRefreshTicketsPage=function(){var t=jQuery("#ticket-tabs").tabs("option","active"),e="#tickets-tab-"+ ++t,s=jQuery(e+" .ksd-pagination-limit").val(),i=jQuery(e+" .ksd_tkt_search_input").val();jQuery(e).addClass("pending");var a=_getCurrentPage(t);_this.getTickets(e,i,s,a-1,!0)},this.attachRefreshTicketsPage=function(){jQuery(".ksd-ticket-refresh button").click(function(){_this.ksdRefreshTicketsPage()})},this.TicketSearch=function(){jQuery(".ksd-tkt-search-btn").click(function(){var t=jQuery(this).attr("id").replace("ksd_tkt_search_btn_",""),e=jQuery("input[name=ksd_tkt_search_input_"+t+"]").val(),s="#tickets-tab-"+t,i=jQuery("#ksd_pagination_limit_"+t).val();jQuery(s).addClass("pending"),_this.getTickets("#tickets-tab-"+t,e,i,0,!0)}),jQuery(".ksd_tkt_search_input").bind("keypress",function(t){if(13===t.keyCode){var e=jQuery(this).attr("name").replace("ksd_tkt_search_input_",""),s=jQuery("input[name=ksd_tkt_search_input_"+e+"]").val(),i="#tickets-tab-"+e,a=jQuery("#ksd_pagination_limit_"+e).val();jQuery(i).addClass("pending"),_this.getTickets("#tickets-tab-"+e,s,a)}})},_getTabId=function(t){var e="#tickets-tab-"+t;return e},RowCtrlEffects=function(){jQuery(".ksd-row-ctrl").bind("hover mouseover focus",function(){var t=(jQuery(this).attr("id"),jQuery(this).attr("id").replace("ksd_tkt_ctrl_",""));jQuery("#ksd_tkt_id_"+t).addClass("ksd-row-ctrl-hover")}),jQuery(".ksd-row-ctrl").mouseout(function(){var t=(jQuery(this).attr("id"),jQuery(this).attr("id").replace("ksd_tkt_ctrl_",""));jQuery("#ksd_tkt_id_"+t).removeClass("ksd-row-ctrl-hover")}),jQuery("#ticket-tabs .tkt_chkbx_all").on("click",function(){jQuery(this).prop("checked")===!0?(jQuery("#tkt_all_options").removeClass("ticket-actions"),jQuery("input:checkbox").not(this).prop("checked",this.checked),tab_id=jQuery(this).attr("id").replace("tkt_chkbx_all_",""),jQuery("#ksd_row_all_"+tab_id).removeClass("ksd-row-all-hide").addClass("ksd-row-all-show")):(jQuery("#tkt_all_options").addClass("ticket-actions"),jQuery("input:checkbox").not(this).prop("checked",this.checked),tab_id=jQuery(this).attr("id").replace("tkt_chkbx_all_",""),jQuery("#ksd_row_all_"+tab_id).removeClass("ksd-row-all-show").addClass("ksd-row-all-hide"))})},_getCurrentPage=function(t){var e=jQuery("#ksd_pagination_"+t+" ul li .current-nav").html();return parseInt(e)},_getPagLimt=function(t){var e=jQuery("#ksd_pagination_limit_"+t).val();return e},_loadTicketPagination=function(t,e,s,a){if("o"!==s&&"0"!==s){var n=s/a;for(jQuery("#ksd_pagination_"+t+" ul li").remove(),jQuery("#ksd_pagination_"+t+" ul").append('                        <li><a rel="external" href="#"><<</a></li>                          <li><a rel="external" href="#"><</a></li>'),i=0;i<n;i++)currentclass=i===e-1?"current-nav":"",ii=i+1,jQuery("#ksd_pagination_"+t+" ul").append('                             <li><a rel="external" href="#" class="'+currentclass+'">'+ii+"</a></li>                         ");jQuery("#ksd_pagination_"+t+" ul").append('                        <li><a rel="external" href="#">></a></li>                          <li><a rel="external" href="#">>></a></li>'),jQuery("#ksd_pagination_"+t+" ul li a").click(function(){var e=jQuery(this).html(),i=_getCurrentPage(t),a=_getPagLimt(t),n=Math.ceil(s/a);if((">"===e||"&gt;"===e)&&(e=i+1),(">>"===e||"&gt;&gt;"===e)&&(e=Math.ceil(s/a)),("<"===e||"&lt;"===e)&&(e=i-1),("<<"===e||"&lt;&lt;"===e)&&(e=1),!(1>e||e>n||e===i)){var a=jQuery("#ksd_pagination_limit_"+t).val(),r=jQuery("input[name=ksd_tkt_search_input_"+t+"]").val();jQuery(_getTabId(t)).addClass("pending"),_this.getTickets(_getTabId(t),r,a,e-1)}})}}},KSDAnalytics.init(),Settings=new KSDSettings,Settings.init(),Dashboard=new KSDDashboard,Dashboard.init(),KSDHelpObj=new KSDHelp,KSDHelpObj.init(),Tickets=new KSDTickets,Tickets.init()});